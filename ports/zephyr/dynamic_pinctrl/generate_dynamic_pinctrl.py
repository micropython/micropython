import argparse
import re

parser = argparse.ArgumentParser(
    prog="generate_dynamic_pinctrl", description="convert preprocessed define list to table"
)

parser.add_argument("filename_out", type=argparse.FileType("wt"))
parser.add_argument("names", nargs=argparse.REMAINDER)
args = parser.parse_args()

args.filename_out.write("/* Generated by generate_dynamic_pinctrl.py\n * Do not Edit\n */\n")
args.filename_out.write("static mp_rom_map_elem_t generated_dynamic_pinmuxes[] = {\n")
for name in args.names:
    name_clean = re.sub(r"[\s\\]", "", name)
    args.filename_out.write("  { ")
    args.filename_out.write("MP_ROM_QSTR(MP_QSTR_{}),".format(str(name_clean)))
    args.filename_out.write(" MP_ROM_INT({})".format(str(name_clean)))
    args.filename_out.write(" },\n")
args.filename_out.write("};\n")
